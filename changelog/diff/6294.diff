Index: qa/hudson-jbpm4-enterprise.sh
===================================================================
--- qa/hudson-jbpm4-enterprise.sh	(revision 6293)
+++ qa/hudson-jbpm4-enterprise.sh	(revision 6294)
@@ -2,15 +2,14 @@
 #
 # runs the jboss integration test suite
 
-MAVEN_OPTS="-Xms1024M -Xmx1024M"
-ANT_PROPERTIES="-Djboss.version=$JBOSS_VERSION -Djbpm.parent.dir=$WORKSPACE -Djboss.distro.dir=$SOURCE_REPO/jboss"
-echo ANT_PROPERTIES=${ANT_PROPERTIES}
+MAVEN_OPTS="-Xmx512M -Djboss.bind.address=$JBOSS_BINDADDR"
+ANT_OPTS="-Djboss.version=$JBOSS_VERSION -Djbpm.parent.dir=$WORKSPACE -Djboss.distro.dir=$SOURCE_REPO/jboss -Djboss.bind.address=$JBOSS_BINDADDR"
 
 mvn -U -Pdistro,enterprise clean install
-ant -f qa/build.xml $ANT_PROPERTIES testsuite.enterprise.setup
+ant -f qa/build.xml testsuite.enterprise.setup
 
 cd modules/test-enterprise/test-enterprise-suite
 mvn -Pruntest test
 cd ../../..
 
-ant -f qa/build.xml $ANT_PROPERTIES testsuite.enterprise.teardown
+ant -f qa/build.xml testsuite.enterprise.teardown
Index: qa/hudson-jbpm4-jboss.sh
===================================================================
--- qa/hudson-jbpm4-jboss.sh	(revision 6293)
+++ qa/hudson-jbpm4-jboss.sh	(revision 6294)
@@ -2,18 +2,18 @@
 #
 # runs the jboss integration test suite
 
-MAVEN_OPTS="-Xms256M -Xmx1024M"
-ANT_PROPERTIES="-Djboss.version=$JBOSS_VERSION -Djbpm.parent.dir=$WORKSPACE -Djboss.distro.dir=$SOURCE_REPO/jboss -Djboss.bind.address=$JBOSS_BINDADDR"
+MAVEN_OPTS="-Xmx512M -Djboss.bind.address=$JBOSS_BINDADDR"
+ANT_OPTS="-Djboss.version=$JBOSS_VERSION -Djbpm.parent.dir=$WORKSPACE -Djboss.distro.dir=$SOURCE_REPO/jboss -Djboss.bind.address=$JBOSS_BINDADDR"
 
 # just in case the previous run didnt complete ok, we stop jboss
-ant -f modules/distro/src/main/files/install/build.xml $ANT_PROPERTIES stop.jboss
-ant -f modules/distro/src/main/files/install/build.xml $ANT_PROPERTIES reinstall.jboss
+ant -f modules/distro/src/main/files/install/build.xml reinstall.jboss
+ant -f modules/distro/src/main/files/install/build.xml stop.jboss
 
 mvn -U -Pdistro,integration clean install
-ant -f qa/build.xml $ANT_PROPERTIES testsuite.jboss.setup
+ant -f qa/build.xml testsuite.jboss.setup
 
 cd modules/test-cactus
-mvn -Pruntest -Djboss.bind.address=$JBOSS_BINDADDR test
+mvn -Pruntest test
 cd ../..
 
-ant -f qa/build.xml $ANT_PROPERTIES testsuite.jboss.teardown
+ant -f qa/build.xml testsuite.jboss.teardown
Index: qa/hudson-jbpm4-tomcat.sh
===================================================================
--- qa/hudson-jbpm4-tomcat.sh	(revision 6293)
+++ qa/hudson-jbpm4-tomcat.sh	(revision 6294)
@@ -2,16 +2,15 @@
 #
 # runs the jboss integration test suite
 
-MAVEN_OPTS="-Xms1024M -Xmx1024M"
+MAVEN_OPTS="-Xmx512M"
+ANT_OPTS="-Djbpm.parent.dir=$WORKSPACE -Djboss.distro.dir=$SOURCE_REPO/jboss -Dtomcat.distro.dir=tomcat.downloads" 
 
-ANT_PROPERTIES="-Djbpm.parent.dir=$WORKSPACE -Djboss.distro.dir=$SOURCE_REPO/jboss -Dtomcat.distro.dir=tomcat.downloads" 
-
 mvn -U -Pdistro,integration clean install
-ant -f qa/build.xml $ANT_PROPERTIES reinstall.jbpm
-ant -f qa/build.xml $ANT_PROPERTIES testsuite.tomcat.setup
+ant -f qa/build.xml reinstall.jbpm
+ant -f qa/build.xml testsuite.tomcat.setup
 
 cd modules/test-cactus
 mvn -Pruntest test
 cd ../..
 
-ant -f qa/build.xml $ANT_PROPERTIES testsuite.tomcat.teardown
+ant -f qa/build.xml testsuite.tomcat.teardown
Index: qa/hudson-jbpm4-upgrade.sh
===================================================================
--- qa/hudson-jbpm4-upgrade.sh	(revision 6293)
+++ qa/hudson-jbpm4-upgrade.sh	(revision 6294)
@@ -2,19 +2,18 @@
 #
 # runs the upgrade tests
 
-MAVEN_OPTS="-Xms1024M -Xmx1024M"
-ANT_PROPERTIES="-Dold.jbpm.version=$OLD_JBPM_VERSION -Ddatabase=$DATABASE -Djbpm.parent.dir=$WORKSPACE"
-echo ANT_PROPERTIES=${ANT_PROPERTIES}
+MAVEN_OPTS="-Xmx512M"
+ANT_OPTS="-Dold.jbpm.version=$OLD_JBPM_VERSION -Ddatabase=$DATABASE -Djbpm.parent.dir=$WORKSPACE"
 
 cd qa/upgrade
-mvn $ANT_PROPERTIES dependency:copy
+mvn $ANT_OPTS dependency:copy
 cd ../..
 
 mvn -U -Pdistro,integration clean install
-ant -f qa/build.xml $ANT_PROPERTIES testsuite.upgrade.setup
+ant -f qa/build.xml testsuite.upgrade.setup
 
 cd modules/test-upgrade
-mvn $ANT_PROPERTIES clean test
+mvn $ANT_OPTS clean test
 cd ../..
 
-ant -f qa/build.xml $ANT_PROPERTIES testsuite.upgrade.teardown
+ant -f qa/build.xml testsuite.upgrade.teardown
Index: modules/test-cactus/src/test/resources/jndi.properties
===================================================================
--- modules/test-cactus/src/test/resources/jndi.properties	(revision 0)
+++ modules/test-cactus/src/test/resources/jndi.properties	(revision 6294)
@@ -0,0 +1,3 @@
+java.naming.factory.initial=org.jnp.interfaces.NamingContextFactory
+java.naming.factory.url.pkgs=org.jboss.naming:org.jnp.interfaces
+java.naming.provider.url=jnp://@jboss.bind.address@:1099
Index: modules/test-cactus/pom.xml
===================================================================
--- modules/test-cactus/pom.xml	(revision 6293)
+++ modules/test-cactus/pom.xml	(revision 6294)
@@ -1,15 +1,15 @@
 <?xml version="1.0" encoding="UTF-8"?>
 
-  <!-- ====================================================================== -->
-  <!--                                                                        -->
-  <!--  JBoss, the OpenSource J2EE webOS                                      -->
-  <!--                                                                        -->
-  <!--  Distributable under LGPL license.                                     -->
-  <!--  See terms of license at http://www.gnu.org.                           -->
-  <!--                                                                        -->
-  <!-- ====================================================================== -->
+<!-- ====================================================================== -->
+<!--                                                                        -->
+<!--  JBoss, the OpenSource J2EE webOS                                      -->
+<!--                                                                        -->
+<!--  Distributable under LGPL license.                                     -->
+<!--  See terms of license at http://www.gnu.org.                           -->
+<!--                                                                        -->
+<!-- ====================================================================== -->
 
-  <!-- $Id: pom.xml 5319 2009-07-17 10:03:46Z tom.baeyens@jboss.com $ -->
+<!-- $Id: pom.xml 5319 2009-07-17 10:03:46Z tom.baeyens@jboss.com $ -->
 
 <project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
   xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
Index: modules/distro/src/main/files/install/src/hsqldb-server/start-hsqldb-server.sh
===================================================================
--- modules/distro/src/main/files/install/src/hsqldb-server/start-hsqldb-server.sh	(revision 6293)
+++ modules/distro/src/main/files/install/src/hsqldb-server/start-hsqldb-server.sh	(revision 6294)
@@ -1 +1,3 @@
-java -cp hsqldb.jar org.hsqldb.Server -address localhost -port 1701 -dbname.0 jbpmDatabase
\ No newline at end of file
+#!/bin/sh
+[ -z "$JBOSS_BINDADDR" ] && JBOSS_BINDADDR=localhost
+java -cp hsqldb.jar org.hsqldb.Server -address $JBOSS_BINDADDR -port 1701 -dbname.0 jbpmDatabase
\ No newline at end of file
Index: modules/distro/src/main/files/install/build.xml
===================================================================
--- modules/distro/src/main/files/install/build.xml	(revision 6293)
+++ modules/distro/src/main/files/install/build.xml	(revision 6294)
@@ -409,12 +409,12 @@
   <target name="start.jboss"
           description="starts jboss and waits till jboss is booted, then lets jboss run in the background">
     <exec executable="${jboss.home}/bin/run.bat"
-          os="Windows Vista, Windows XP,Windows 2000,Windows 98">
-      <arg value="-c" />
+          osfamily="windows">
+      <arg value="-b" />
       <arg value="${jboss.bind.address}" />
     </exec>
-    <exec executable="${jboss.home}/bin/run.sh" os="Linux, Unix, Mac">
-      <arg value="-c" />
+    <exec executable="${jboss.home}/bin/run.sh" osfamily="unix">
+      <arg value="-b" />
       <arg value="${jboss.bind.address}" />
     </exec>
     <waitfor maxwait="5" maxwaitunit="minute" checkevery="30" checkeveryunit="second">
@@ -425,12 +425,11 @@
   <!-- ### STOP JBOSS ################################################### -->
   <target name="stop.jboss"
           description="signals jboss to stop, but doesn't wait till its finished">
-    <exec executable="${jboss.home}/bin/shutdown.bat"
-          os="Windows Vista, Windows XP,Windows 2000,Windows 98">
-      <arg line="-S" />
+    <exec executable="${jboss.home}/bin/shutdown.bat" osfamily="windows">
+      <arg value="-S" />
     </exec>
-    <exec executable="${jboss.home}/bin/shutdown.sh" os="Linux, Unix, Mac">
-      <arg line="-S" />
+    <exec executable="${jboss.home}/bin/shutdown.sh" osfamily="unix">
+      <arg value="-S" />
     </exec>
   </target>
 
@@ -608,15 +607,15 @@
 
   <!-- ### START HSQLDB SERVER ################################################ -->
   <target name="start.hsqldb.server" if="is.hsqldb">
-    <taskdef name="start-hsqldb-server"
-             classname="org.jbpm.pvm.internal.ant.StartHsqldbServerTask">
-      <classpath>
-        <fileset dir="${jbpm.home}">
-          <include name="jbpm.jar" />
-        </fileset>
-      </classpath>
-    </taskdef>
-    <start-hsqldb-server hsqldbServerHome="${hsqldb.server.install.dir}" />
+    <exec executable="${hsqldb.server.install.dir}/start-hsqldb-server.bat" osfamily="windows">
+      <env key="JBOSS_BINDADDR" value="${jboss.bind.address}" />
+    </exec>
+    <exec executable="${hsqldb.server.install.dir}/start-hsqldb-server.sh" osfamily="unix">
+      <env key="JBOSS_BINDADDR" value="${jboss.bind.address}" />
+    </exec>
+    <waitfor maxwait="1" maxwaitunit="minute" checkevery="10" checkeveryunit="second">
+      <socket server="${jboss.bind.address}" port="1701" />
+    </waitfor>
   </target>
 
   <!-- ### SHUTDOWN HSQLDB SERVER ################################################ -->
@@ -653,13 +652,13 @@
           description="Signals Tomcat to stop, but doesn't wait till its finished">
     <exec executable="${tomcat.home}/bin/catalina.bat"
           dir="${tomcat.home}/bin"
-          os="Windows Vista, Windows XP,Windows 2000,Windows 98">
-      <arg line="stop" />
+          osfamily="windows">
+      <arg value="stop" />
     </exec>
     <exec executable="${tomcat.home}/bin/catalina.sh"
           dir="${tomcat.home}/bin"
-          os="Linux, Unix, Mac">
-      <arg line="stop" />
+          osfamily="unix">
+      <arg value="stop" />
     </exec>
   </target>
 
@@ -778,8 +777,12 @@
   <!-- ### START ECLIPSE ################################################## -->
   <target name="start.eclipse" description="starts eclipse">
     <!-- Windows -->
-    <exec executable="cmd" os="Windows Vista, Windows XP,Windows 2000,Windows 98">
-      <arg line="/C start &quot;${jbpm.home}/eclipse/eclipse.exe&quot; &quot;-data&quot; &quot;${jbpm.home}/workspace&quot;" />
+    <exec executable="cmd" osfamily="windows">
+      <arg value="/C" />
+      <arg value="start" />
+      <arg value="${jbpm.home}/eclipse/eclipse.exe" />
+      <arg value="-data" />
+      <arg value="${jbpm.home}/workspace" />
     </exec>
     <!-- Unix -->
     <chmod perm="+x">
@@ -791,10 +794,16 @@
       </fileset>
     </chmod>
     <exec executable="/bin/bash" os="Linux">
-      <arg line="-c &quot;${jbpm.home}/eclipse/eclipse&quot; &quot;-data&quot; &quot;${jbpm.home}/workspace&quot;" />
+      <arg value="-c" />
+      <arg value="${jbpm.home}/eclipse/eclipse" />
+      <arg value="-data" />
+      <arg value="${jbpm.home}/workspace" />
     </exec>
     <exec executable="/bin/bash" os="Mac OS X">
-      <arg line="-c &quot;${jbpm.home}/eclipse/Eclipse.app/Contents/MacOS/eclipse&quot; &quot;-data&quot; &quot;${jbpm.home}/workspace&quot;" />
+      <arg value="-c" />
+      <arg value="${jbpm.home}/eclipse/Eclipse.app/Contents/MacOS/eclipse" />
+      <arg value="-data" />
+      <arg value="${jbpm.home}/workspace"/>
     </exec>
   </target>
 
